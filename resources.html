<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MSE-Resources</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .active-tab { color: #2563eb; border-bottom: 3px solid #2563eb; transition: all 0.2s; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 pb-24">

    <header class="bg-white p-5 sticky top-0 z-50 shadow-sm">
        <h1 id="pageTitle" class="text-2xl font-bold text-slate-800">Books</h1>
        <div class="mt-3 relative">
            <input type="text" id="searchInput" oninput="filterData()" placeholder="Search in this category..." 
                   class="w-full bg-slate-100 border-none rounded-xl py-3 px-10 focus:ring-2 focus:ring-blue-500 outline-none">
            <i data-lucide="search" class="absolute left-3 top-3.5 text-slate-400 w-5 h-5"></i>
        </div>
    </header>

    <main id="contentList" class="p-4 space-y-4">
        <div class="text-center py-20 text-slate-400">Loading Resources...</div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t flex justify-around items-center text-slate-400 z-50 overflow-x-auto">
        <button onclick="switchTab('Books')" class="nav-btn p-4 flex flex-col items-center gap-1 active-tab" id="tab-Books">
            <i data-lucide="book-open" class="w-5 h-5"></i><span class="text-[9px] font-bold">BOOKS</span>
        </button>
        <button onclick="switchTab('Questions')" class="nav-btn p-4 flex flex-col items-center gap-1" id="tab-Questions">
            <i data-lucide="help-circle" class="w-5 h-5"></i><span class="text-[9px] font-bold">QUESTIONS</span>
        </button>
        <button onclick="switchTab('Notes')" class="nav-btn p-4 flex flex-col items-center gap-1" id="tab-Notes">
            <i data-lucide="file-text" class="w-5 h-5"></i><span class="text-[9px] font-bold">NOTES</span>
        </button>
        <button onclick="switchTab('Teachers')" class="nav-btn p-4 flex flex-col items-center gap-1" id="tab-Teachers">
            <i data-lucide="graduation-cap" class="w-5 h-5"></i><span class="text-[9px] font-bold">FACULTY</span>
        </button>
        <button onclick="switchTab('Important_Links')" class="nav-btn p-4 flex flex-col items-center gap-1" id="tab-Important_Links">
            <i data-lucide="link" class="w-5 h-5"></i><span class="text-[9px] font-bold">LINKS</span>
        </button>
    </nav>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyYKtJfcITcM_lXn_SKmpdgknGbUPnxQiIKcqDrnYq-hhZTOexpg8fXvctkMJD6gPYXzQ/exec"; // <--- ENSURE THIS IS THE NEW DEPLOYMENT URL
        let currentData = [];
        let currentTab = 'Books';

        async function switchTab(tabName) {
            currentTab = tabName;
            document.getElementById('pageTitle').innerText = tabName.replace('_', ' ');
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById(`tab-${tabName}`).classList.add('active-tab');
            document.getElementById('contentList').innerHTML = `<div class="text-center py-20">Loading ${tabName}...</div>`;
            document.getElementById('searchInput').value = ""; // Clear search when switching tabs

            try {
                const response = await fetch(`${API_URL}?tab=${tabName}`);
                currentData = await response.json();
                console.log("Data Received:", currentData); // DEBUG: Look at your console (F12) to see columns
                renderData(currentData);
            } catch (e) {
                document.getElementById('contentList').innerHTML = `<div class="text-red-500 text-center p-10">Connection Error. Check API URL.</div>`;
            }
        }

        function renderData(data) {
            const list = document.getElementById('contentList');
            if (!data || data.length === 0) { 
                list.innerHTML = `<p class="text-center text-slate-400 py-10">No items found in this category.</p>`; 
                return; 
            }

            list.innerHTML = data.map(item => {
                // Find keys regardless of exact casing/spaces
                const getVal = (key) => {
                    const foundKey = Object.keys(item).find(k => k.toLowerCase().replace(/\s/g, '') === key.toLowerCase());
                    return foundKey ? item[foundKey] : "";
                };

                if (currentTab === 'Books') return card(getVal('BookName'), `By ${getVal('Writer')}`, `Rec For: ${getVal('RecommendedFor')}`, getVal('DriveLink'), 'book');
                if (currentTab === 'Questions') return card(`${getVal('Year')} - ${getVal('Topic')}`, `Chapter: ${getVal('Chapter')}`, `Teacher: ${getVal('Teacher')} (${getVal('Mark')} Marks)`, '#', 'help-circle');
                if (currentTab === 'Notes') return card(getVal('Chapter'), `By ${getVal('Writer')}`, `Teacher: ${getVal('Teacher')}`, getVal('DriveLink'), 'file-text');
                if (currentTab === 'Teachers') return card(getVal('Name'), getVal('Role'), `${getVal('ResearchField')} | ${getVal('Study')}`, `mailto:${getVal('Email')}`, 'user');
                if (currentTab === 'Important_Links') return card(getVal('Title'), getVal('Description'), "Visit Link", getVal('Link'), 'external-link');
            }).join('');
            lucide.createIcons();
        }

        function card(title, sub, detail, link, icon) {
            return `
            <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex items-start gap-4 animate-in fade-in slide-in-from-bottom-2 duration-300">
                <div class="bg-blue-50 p-3 rounded-xl text-blue-600"><i data-lucide="${icon}"></i></div>
                <div class="flex-1 overflow-hidden">
                    <h3 class="font-bold text-slate-900 truncate">${title || 'N/A'}</h3>
                    <p class="text-slate-500 text-sm">${sub || ''}</p>
                    <p class="text-slate-400 text-xs mt-1 italic">${detail || ''}</p>
                    ${(link && link !== '#') ? `<a href="${link}" target="_blank" class="inline-block mt-3 px-4 py-1.5 bg-blue-600 text-white rounded-lg text-xs font-bold shadow-sm shadow-blue-200">Open Resource</a>` : ''}
                </div>
            </div>`;
        }

        function filterData() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = currentData.filter(item => 
                Object.values(item).some(val => String(val).toLowerCase().includes(query))
            );
            renderData(filtered);
        }

        // Initialize
        switchTab('Books');
    </script>
</body>
</html>
