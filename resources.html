<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MSE Squad | Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .menu-hidden { transform: translateX(-100%); transition: transform 0.3s ease; }
        .menu-visible { transform: translateX(0); transition: transform 0.3s ease; }
        .hidden { display: none !important; }
        body { -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
    </style>
</head>
<body class="bg-slate-50">

    <div id="loginPage" class="fixed inset-0 bg-white z-[100] flex items-center justify-center p-6">
        <div class="w-full max-w-sm text-center">
            <div class="bg-blue-600 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-xl shadow-blue-200">
                <i data-lucide="shield-check" class="text-white w-8 h-8"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-900 tracking-tight">MSE SQUAD</h2>
            <p class="text-slate-500 text-sm mt-2 mb-8">Enter your registered email to access resources.</p>
            
            <input type="email" id="emailInput" placeholder="name@example.com" 
                   class="w-full bg-slate-100 border-2 border-transparent focus:border-blue-500 focus:bg-white rounded-2xl py-4 px-6 outline-none transition-all mb-4 text-center font-medium">
            
            <button onclick="handleLogin()" id="loginBtn" 
                    class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2">
                <span>Unlock Access</span>
            </button>
            <p id="loginError" class="text-red-500 text-xs font-bold mt-4 hidden">Access Denied. Email not found.</p>
        </div>
    </div>

    <div id="mainApp" class="hidden min-h-screen">
        <header class="bg-white p-5 sticky top-0 z-40 shadow-sm flex items-center gap-4">
            <button onclick="toggleMenu()" class="p-2 hover:bg-slate-100 rounded-lg"><i data-lucide="menu"></i></button>
            <h1 id="pageTitle" class="text-xl font-bold text-slate-800">Books</h1>
        </header>

        <div id="sideMenuOverlay" onclick="toggleMenu()" class="fixed inset-0 bg-black/50 z-50 hidden"></div>
        <div id="sideMenu" class="fixed top-0 left-0 h-full w-72 bg-white z-[51] menu-hidden p-6 flex flex-col shadow-2xl">
            <div class="flex justify-between items-center mb-8">
                <span class="text-blue-600 font-black text-xl italic">MSE SQUAD</span>
                <button onclick="logout()" class="text-slate-400 hover:text-red-500"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
            <nav class="space-y-1 flex-1 overflow-y-auto">
                <button onclick="switchTab('Books')" class="w-full text-left p-3 rounded-xl hover:bg-blue-50 flex items-center gap-3"><i data-lucide="book" class="w-4 h-4"></i> Books</button>
                <button onclick="switchTab('Student')" class="w-full text-left p-3 rounded-xl hover:bg-blue-50 flex items-center gap-3"><i data-lucide="users" class="w-4 h-4"></i> Students</button>
                <button onclick="switchTab('OtherResources')" class="w-full text-left p-3 rounded-xl hover:bg-blue-50 flex items-center gap-3"><i data-lucide="archive" class="w-4 h-4"></i> Others</button>
                <button onclick="switchTab('Important_Links')" class="w-full text-left p-3 rounded-xl hover:bg-blue-50 flex items-center gap-3"><i data-lucide="link" class="w-4 h-4"></i> Links</button>
            </nav>
            <div class="mt-auto p-4 bg-slate-50 rounded-2xl border border-slate-100">
                <p id="userDisplay" class="text-[10px] text-slate-400 font-bold truncate uppercase mb-1"></p>
                <p id="lastSync" class="text-[11px] text-slate-700 font-bold italic">Checking sync...</p>
            </div>
        </div>

        <main id="contentList" class="p-4 space-y-3"></main>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-c3lGxNcBa_L3A-yIx5jVT5cDAML5frBLsgQNwRBQMIoYLOAEkOKf8r7P0QwuvaHc_A/exec"; // <--- PASTE YOUR URL HERE
        let currentEmail = localStorage.getItem('mse_email');

        const mappings = {
            'Books': { t: 'BookName', s: 'Writer', d: 'RecommendedFor', l: 'DriveLink' },
            'Student': { t: 'Name', s: 'StudentID', d: 'Hometown', l: 'FBIDLink' },
            'OtherResources': { t: 'Title', s: 'Category', d: 'Description', l: 'Link' },
            'Important_Links': { t: 'Topic', s: 'Description', d: 'Link', l: 'Link' }
        };

        // Initialize App
        async function init() {
            lucide.createIcons();
            if (currentEmail) {
                const isAuthorized = await verifyEmail(currentEmail);
                if (isAuthorized) {
                    showApp();
                } else {
                    localStorage.removeItem('mse_email');
                }
            }
        }

        async function verifyEmail(email) {
            try {
                const response = await fetch(`${SCRIPT_URL}?checkAuth=true&email=${encodeURIComponent(email)}`);
                const result = await response.json();
                return result.authorized;
            } catch (e) { return false; }
        }

        async function handleLogin() {
            const email = document.getElementById('emailInput').value.trim();
            const btn = document.getElementById('loginBtn');
            const error = document.getElementById('loginError');
            
            if (!email) return;
            btn.innerHTML = `<span class="animate-spin mr-2">‚è≥</span> Verifying...`;
            
            const isAuthorized = await verifyEmail(email);
            if (isAuthorized) {
                localStorage.setItem('mse_email', email);
                currentEmail = email;
                showApp();
            } else {
                btn.innerText = "Unlock Access";
                error.classList.remove('hidden');
            }
        }

        function showApp() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userDisplay').innerText = currentEmail;
            switchTab('Books');
        }

        async function switchTab(tabName) {
            document.getElementById('pageTitle').innerText = tabName;
            if(!document.getElementById('sideMenu').classList.contains('menu-hidden')) toggleMenu();
            const list = document.getElementById('contentList');
            list.innerHTML = `<div class="text-center py-20 animate-pulse text-slate-400">Syncing...</div>`;

            try {
                const res = await fetch(`${SCRIPT_URL}?tab=${tabName}&email=${encodeURIComponent(currentEmail)}`);
                const result = await res.json();
                document.getElementById('lastSync').innerText = result.lastUpdated;
                renderItems(result.data, tabName);
            } catch (e) {
                list.innerHTML = `<div class="text-center py-20 text-red-400 font-bold">Failed to load. Try again.</div>`;
            }
        }

        function renderItems(data, tab) {
            const list = document.getElementById('contentList');
            const map = mappings[tab];
            list.innerHTML = data.map((item, idx) => `
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-5">
                    <h3 class="font-bold text-slate-900 text-sm uppercase">${item[map.t] || '---'}</h3>
                    <p class="text-slate-500 text-xs">${item[map.s] || ''}</p>
                    <p class="text-blue-600 text-[10px] mt-2 font-bold uppercase tracking-wider">${item[map.d] || ''}</p>
                    ${item[map.l] ? `<a href="${item[map.l]}" target="_blank" class="block mt-4 text-center bg-slate-100 py-2 rounded-xl text-[10px] font-black hover:bg-blue-50 hover:text-blue-600 transition-all">OPEN RESOURCE</a>` : ''}
                </div>
            `).join('');
            lucide.createIcons();
        }

        function logout() {
            localStorage.removeItem('mse_email');
            location.reload();
        }

        function toggleMenu() {
            document.getElementById('sideMenu').classList.toggle('menu-hidden');
            document.getElementById('sideMenuOverlay').classList.toggle('hidden');
        }

        init();
    </script>
</body>
</html>
